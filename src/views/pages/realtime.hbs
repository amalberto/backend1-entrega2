{{> header}}
<h2>Gestioná los productos disponibles</h2>

<section style="display:grid;grid-template-columns:2fr 1fr;gap:32px;">
  <div>

    <!-- CONTROLES DE LISTADO -->
    <form id="filters-form" style="display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end;margin:16px 0;padding:16px;background:#f8f9fa;border-radius:8px;border:1px solid #e9ecef;">
      <label>Limit<br>
        <input name="limit" type="number" min="1" value="10" style="width:80px;padding:6px;border:1px solid #ccc;border-radius:4px;">
      </label>
      <label>Ordenar por precio<br>
        <select name="sort" style="padding:6px;border:1px solid #ccc;border-radius:4px;">
          <option value="">(sin orden)</option>
          <option value="asc">Menor a mayor</option>
          <option value="desc">Mayor a menor</option>
        </select>
      </label>
      <label>Categoría<br>
        <select name="category" style="padding:6px;border:1px solid #ccc;border-radius:4px;width:140px;">
          <option value="">Todas</option>
          {{#each categories}}
          <option value="{{this.value}}">{{this.text}}</option>
          {{/each}}
        </select>
      </label>
      <label>Estado<br>
        <select name="status" style="padding:6px;border:1px solid #ccc;border-radius:4px;">
          <option value="">Todos</option>
          <option value="true">Activos</option>
          <option value="false">Inactivos</option>
        </select>
      </label>
      <button type="submit" style="background:#3498db;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-weight:bold;">Aplicar</button>
      <button type="button" id="filters-clear" style="background:#95a5a6;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;">Limpiar</button>
      <button type="button" id="delete-all-btn" style="background:#e74c3c;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-weight:bold;">Eliminar Todos</button>
    </form>

    <!-- PAGINADOR -->
    <div style="display:flex;gap:12px;align-items:center;margin:12px 0;padding:12px;background:#ffffff;border-radius:6px;border:1px solid #dee2e6;">
      <button id="page-prev" disabled style="background:#6c757d;color:white;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-weight:bold;">« Anterior</button>
      <span style="padding:0 16px;">Página <strong id="page-current" style="color:#2ecc71;">1</strong> de <strong id="page-total" style="color:#3498db;">1</strong></span>
      <button id="page-next" disabled style="background:#6c757d;color:white;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-weight:bold;">Siguiente »</button>
      <span style="margin-left:auto;font-weight:bold;color:#e74c3c;">Mostrados: <strong id="results-count">0</strong> productos / Total: <strong id="total-count">0</strong></span>
    </div>

    <ul id="products-list">
      {{#if products.length}}
        {{#each products}}
        <li data-id="{{id}}" style="padding:16px;margin:8px 0;border:1px solid #ddd;border-radius:8px;background:#fafafa;box-shadow:0 2px 4px rgba(0,0,0,0.05);">
          <!-- TÍTULO Y PRECIO -->
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <strong style="color:#2c3e50;font-size:16px;">{{title}}</strong>
            <span style="background:#27ae60;color:white;padding:4px 8px;border-radius:12px;font-weight:bold;">${{price}}</span>
          </div>
          
          <!-- DESCRIPCIÓN -->
          <div style="color:#666;font-size:14px;margin-bottom:8px;">{{description}}</div>
          
          <!-- DETALLES -->
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;margin-bottom:12px;font-size:12px;color:#888;">
            <span><strong>ID:</strong> {{id}}</span>
            <span><strong>Código:</strong> {{code}}</span>
            <span><strong>Categoría:</strong> {{category}}</span>
          </div>
          
          <!-- STOCK Y ESTADO -->
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span style="font-weight:bold;color:#27ae60;">Stock: {{stock}}</span>
            <span style="padding:3px 8px;border-radius:12px;font-size:12px;font-weight:bold;color:white;background:{{#if status}}#27ae60{{else}}#e74c3c{{/if}};">
              {{#if status}}ACTIVO{{else}}INACTIVO{{/if}}
            </span>
          </div>
          
          <!-- BOTONES DE ACCIÓN -->
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button onclick="updateStock({{id}}, '{{title}}')" 
                    style="background:#3498db;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;font-weight:bold;margin:2px;">
              +/- Unidades
            </button>
            <button onclick="editProduct({{id}})" 
                    style="background:#f39c12;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;font-weight:bold;margin:2px;">
              Editar
            </button>
            <button onclick="deleteProduct({{id}})" 
                    style="background:#e74c3c;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;font-weight:bold;margin:2px;">
              Eliminar
            </button>
          </div>
        </li>
        {{/each}}
      {{else}}
      <li style="text-align:center;padding:40px;color:#666;font-style:italic;">No hay productos aún.</li>
      {{/if}}
    </ul>

    <!-- LINKS CRUDOS (debug) -->
    <div style="margin-top:8px;font-size:12px;">
      <span>prevLink: <a id="prev-link" href="#" target="_blank" rel="noreferrer">—</a></span> |
      <span>nextLink: <a id="next-link" href="#" target="_blank" rel="noreferrer">—</a></span>
    </div>
  </div>

  <!-- Formulario de creación con fondo gris -->
  <div style="background:#f5f5f5;padding:24px;border-radius:12px;border:1px solid #ddd;height:fit-content;">
    <h3 style="margin-top:0;color:#333;">Crear producto</h3>
    <form id="create-form" style="display:flex;flex-direction:column;gap:14px;">
      <label style="color:#555;font-weight:bold;">Título <input name="title" required style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);"></label>
      
      <label style="color:#555;font-weight:bold;">Descripción <input name="description" required style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);"></label>
      
      <label style="color:#555;font-weight:bold;">Código SKU (formato automático)
        <input id="create-code" name="code" required placeholder="Ej: 25, SAS27, SKU-27" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
        <small style="color:#666;font-size:12px;">Se formateará automáticamente como SKU-XXXX</small>
      </label>
      
      <label style="color:#555;font-weight:bold;">Precio 
        <div style="display:flex;align-items:center;gap:4px;">
          <span style="font-weight:bold;">$</span>
          <input name="price" type="number" step="0.01" min="0" required style="flex:1;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
        </div>
      </label>
      
      <label style="color:#555;font-weight:bold;">Stock inicial
        <div style="display:flex;align-items:center;gap:8px;margin-top:4px;">
          <button type="button" id="stock-decrease" style="background:#e74c3c;color:white;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,0.1);">-</button>
          <input name="stock" type="number" step="1" min="0" value="1" required style="width:80px;text-align:center;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
          <button type="button" id="stock-increase" style="background:#27ae60;color:white;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,0.1);">+</button>
        </div>
      </label>
      
      <label style="color:#555;font-weight:bold;">Categoría 
        <select id="category-select" name="category" required style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
          <option value="">Seleccionar categoría</option>
          {{#each categories}}
          <option value="{{this.value}}">{{this.text}}</option>
          {{/each}}
          <option value="__nueva__">+ Crear nueva categoría</option>
        </select>
      </label>
      
      <div id="new-category-input" style="display:none;margin-top:8px;">
        <label style="color:#555;font-weight:bold;">Nueva categoría
          <input id="new-category-text" type="text" placeholder="Nombre de la nueva categoría" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);">
        </label>
      </div>
      
      <label style="color:#555;font-weight:bold;">Thumbnails (URLs separadas por coma) 
        <textarea name="thumbnails" placeholder="http://example.com/img1.jpg, http://example.com/img2.jpg" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;background:white;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);min-height:60px;resize:vertical;"></textarea>
      </label>
      
      <label style="display:flex;align-items:center;gap:8px;color:#555;font-weight:bold;">
        <input name="status" type="checkbox" checked style="transform:scale(1.2);">
        <span>Producto activo</span>
      </label>
      
      <button type="submit" style="background:#2ecc71;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-weight:bold;font-size:16px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">Crear Producto</button>
    </form>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/realtime.js"></script>


